<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="utf-8">
    <title>Lab 7</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@900&display=swap');

        h1, div {
          background-color: rgba(255, 255, 0, 0.1);
          font-family: 'Noto Serif JP', serif;
          font-size: 24pt;
          border: solid 1px black;
          width: 90%;
          margin: 5px auto;
          padding: 10px;
        }

        div {
          font-size: 12pt;
        }
        
        body {
            background-color: rgba(255, 128, 255, 0.1);
        }

        video:hover {
            box-shadow: 0 0 2px 1px rgba(0, 140, 186, 0.5);
        }
    </style>
    <script src="http://d3js.org/d3.v6.min.js" charset="utf-8"></script> <!-- v6.5.0 -->
</head>
<body>
    <h1>
        lab07 漢字變形 Path Transitions
    </h1>
    <div>
      限定使用 D3.js，參考以下影片。
    	<ul>
    		<li><a href="https://bocoup.com/blog/improving-d3-path-animation">Improving D3 Path Animation</a></li>
    		<li><a href="https://bost.ocks.org/mike/dpath/">https://bost.ocks.org/mike/path/</a></li>
    	</ul>
    </div>

    <div>
  		<video width="400" controls loop autoplay>
  		  <source src="2.mp4" type="video/mp4">
  		</video>
    </div>

    <div>
      展示區 (姓名)
      <hr>
      <div id="rect" style="width: 256px;height: 256px;display: inline-block;"></div>
      <div style="width: 256px;height: 256px;display: inline-block;">
	    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="-10 0 273 256">
		   	<path id="first" fill="currentColor"
				d="M181 16l8 4q3 3 -1 5q-20 4 -31 12q-8 5 -1 -2q2 -1 2 -2t-2 -2l-6 2t-5 1q-3 1 -3 0q-1 -2 2 -3q4 -1 11 -3q8 -3 13 -5q4 -1 6 -4l1 -1q1 -4 6 -2zM97 30q6 4 11 8q2 3 1 4q0 1 -3 1q-7 -1 -25 27h3h7q3 1 3 3q1 4 -2 4q-3 2 -7 2q-17 27 -30 36l9 -3q8 -3 12 -5
				q8 -4 12 0q5 6 12 11q1 -1 7 -3t18 -5t19 -6q-8 -5 -15 -13q-4 -5 4 -10q2 0 2 -6q-1 -13 -2 -21q-1 -9 -3 -20q-1 -2 0 -2q0 -1 3 0v2q4 4 4 6v12q1 12 1 18q-1 14 13 31q11 -4 20 -7q6 -2 7 -6q1 -3 5 -2q7 1 11 2h3q3 1 3 3q0 1 -3 1q-5 1 -15 4l-8 2q-2 1 -6 2
				q-24 9 -29 15q-7 5 -2 -2q1 -1 0 -2h-3q-3 1 -4 2q-10 3 -16 6t-14 1q1 3 -3 4q-5 1 -8 11q-10 25 -42 65q-4 4 -6 4t-3 -2q-11 -17 -9 -37q0 -4 1 -5q1 0 2 4q0 9 5 22q0 2 1 2q4 10 12 2q29 -36 39 -71q0 -9 -7 -9q-14 4 -38 20q-4 3 -5 2q-2 0 -2 -4q0 -6 4 -7h2
				q4 -1 6 -4q-2 -2 5 -8q10 -10 19 -25q-29 14 -33 8q-3 -3 2 -6q9 0 28 -11q17 -20 19 -35q1 -3 -3 -4q-6 1 -15 5q-9 3 -17 -2q-2 -1 -2 -2q1 -1 4 -1q4 4 29 -6q7 -3 12 0zM182 49q1 3 -4 5q-13 5 -23 18q-5 5 -2 -2q2 -1 4 -5q1 -4 -1 -4h-5q-3 0 -3 -1t3 -2q6 -2 14 -7
				q5 -5 17 -2zM165 73q2 -3 13 -2q2 1 2 3q-1 2 -4 2q-8 2 -12 5q-6 3 -11 1q-2 -1 2 -3q2 0 7 -4q1 -1 3 -2zM177 111q-2 -1 0 -2q8 1 14 2q2 1 1 3q-1 1 -3 1q-3 1 -4 2q-7 1 -10 4q-10 8 -20 15q20 33 42 47q6 5 17 4q14 0 20 1q7 1 16 2q3 2 3 3t-3 1q-10 -1 -16 -1h-17
				q-13 2 -23 -7q-29 -25 -43 -48q-7 4 -8 3t5 -6q-3 -6 -9 -3q-5 2 -2 -2q3 -3 9 -4q2 0 7 6q28 -19 24 -21zM130 122h-1q-7 1 -5 24q0 41 4 52q2 5 7 -1q9 -8 18 -23q2 -3 3 -3q1 1 0 5q-3 8 -13 26q-2 2 -3 4q-2 2 -3 2q-1 1 -2 -1q-1 -1 -3 -2t-3 -1q-7 0 -8 -17
				q-1 -7 -1 -19q-1 -13 -1 -28q0 -12 9 -20q4 -3 2 2z" />
		</svg>
    </div>
    <div id="rect2" style="width: 256px;height: 256px;display: inline-block;"></div>
    <div style="width: 256px;height: 256px;display: inline-block;">
	    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="-10 0 273 256">
		   	<path id="second" fill="currentColor"
				d="M159 -9q9 7 8 8q-3 16 -6 29q6 1 35 -9q8 -3 21 2q2 1 1 3q0 2 -2 2q-5 0 -10 3q-26 15 -44 21q24 -6 29 -4q6 3 2 6q-46 4 -83 21q-7 3 -5 -1q2 -6 6 -6q0 2 4 -1q8 -3 27 -9q6 -8 11 -21q-14 3 -27 4q-3 -1 0 -2q7 -2 20 -5l8 -2q6 -32 3 -38q0 -3 2 -1zM170 115l-7 1
				q-6 5 -2 26q14 -3 30 -5q-1 -5 8 -4q13 3 28 10q0 5 -5 4q-14 -7 -25 -7q-9 -1 -36 4q-2 8 -1 33q0 21 2 34q0 10 11 23q1 1 0 3q-2 1 -4 1q-8 -4 -15 -16q-6 -8 2 -10q3 0 3 -5q-2 -26 -4 -44q-1 -16 -1 -18q-38 8 -55 15q-5 1 -2 -1l12 -6q-1 -2 2 -4q15 -8 14 -20
				q-2 -3 2 -1q3 5 6 6q3 3 3 4t-3 1q-4 1 -15 12q17 -5 36 -8q-2 -13 -3 -23q-10 3 -29 6q-6 0 0 -2l28 -8q-2 -4 -4 -9q-2 -1 2 -2q10 5 14 8q13 -2 18 -5q3 -3 15 0q3 1 0 2q-15 5 -23 8q-7 2 -2 -2q3 -1 0 -1zM63 78q-2 -4 2 -2q8 9 6 9q-1 3 -2 13v9q6 -3 16 -5q2 0 2 1
				q1 2 -1 2q-8 6 -17 12q-1 2 -1 4q-2 25 0 32q14 -14 33 -35q7 -8 2 2q-37 45 -61 63q-14 11 -22 7q-4 0 1 -2q13 -2 39 -29q0 -12 -1 -14q-2 -3 2 -6l1 -10q0 2 1 -5q0 -4 -2 -2q-9 5 -20 5h-3q0 -1 3 -3q11 -4 23 -13q1 -14 1 -20q-1 -6 -2 -13zM175 70h3q2 -1 5 -2
				q7 -1 15 3q2 1 1 2q0 1 -2 1q-15 5 -50 22q11 -1 21 -5q4 -4 12 -1q2 1 2 2q-1 2 -3 2q-7 1 -22 7q-5 3 -1 -1q2 -1 -3 -1q-9 3 -17 3q-5 0 -1 -2l8 -3q-2 -3 2 -3q5 -2 10 -5q20 -9 29 -16q1 -2 -2 -2q-3 1 -5 1q-16 3 -24 6q-10 4 -21 5q-6 0 -16 3q-2 1 -4 5q3 4 9 9
				q4 3 5 5q0 4 -3 3q-1 0 -2 -1q-3 -4 -8 -7q-6 -5 -1 -10q-1 -3 4 -6q33 -12 59 -14zM160 33q-1 2 -4 7q-5 11 -7 15q17 -6 53 -30q2 -1 2 -3q-2 -2 -4 -2q-8 3 -20 7q-13 4 -20 6zM81 45q2 1 12 3q3 2 0 4q-9 -3 -34 9q-13 5 -24 3q-5 0 0 -1q12 -1 34 -10q6 -2 7 -6
				q1 -2 5 -2z" />
		</svg>
    </div>
    <div id="rect3" style="width: 256px;height: 256px;display: inline-block;"></div>
    <div style="width: 256px;height: 256px;display: inline-block;">
	    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="-10 0 273 256">
		   	<path id="third" fill="currentColor"
				d="M193 23q0 1 1 1q10 3 16 5v2q-3 3 -5 2h-6q-5 0 -17 2q-3 1 -4 1q-2 1 -4 1q-18 6 -35 3q-5 -1 1 -2h5q15 -2 38 -9q1 -3 4 -5t6 -1zM208 70q2 -1 5 0q10 2 16 3q8 4 12 8q0 3 -5 1q-13 -2 -20 -3h-15q-1 1 -2 1q-9 0 -24 3q0 10 -1 30q-1 23 0 34q-2 57 2 60q3 8 6 13
				q2 6 3 8q-3 2 -5 1l-9 -12q-9 -14 -13 -14q-3 -1 0 -5q2 -1 7 -3q2 -1 5 -2q0 -15 -1 -62v-47q-7 1 -24 5q2 0 -5 1q-7 2 -15 -1q-1 0 1 -2q17 -1 43 -8q-1 -24 -5 -33v-1q1 0 3 1q1 2 2 3q8 5 7 10q-2 8 -1 19h7q12 -2 22 -4q1 -2 4 -4zM87 -4q-1 -2 1 -1q2 4 9 10q2 2 1 3
				q-4 6 -3 26q2 0 7 -2q6 -1 8 -3q3 -1 14 2q2 1 1 2q-7 3 -11 3q-3 1 -7 1q-8 1 -12 2q-1 7 -1 17q1 4 1 6q25 -7 37 10q3 2 0 4q-1 1 -1 2q-2 2 -4 0q-5 0 -4 3q-4 31 -29 36q0 2 -1 5t0 4q3 0 9 -1q21 -4 23 -8q1 -2 4 -2t5 2q5 4 12 9q0 6 -2 6q-1 1 -8 -5q-7 -5 -17 -2
				q-11 2 -19 4q-4 1 -7 1v52q-1 10 3 13q4 8 8 11q1 1 0 2q-2 3 -4 0q-7 -4 -11 -11q-3 -5 -8 -9q0 1 -1 -1q-2 0 -1 -3q0 -1 1 -2q0 -1 4 0q2 2 3 2q2 -1 2 -5v-48q-15 2 -44 11q-16 6 -27 5q-3 0 -1 -1q8 -4 21 -7q5 -1 20 -5q13 -2 31 -7v-10q-5 -1 -6 -3q-1 -1 1 -1l1 1
				q1 0 4 -1v-6q-9 5 -20 4q2 5 0 4q-9 -2 -15 -7q-2 0 -3 -3v-2q-1 -2 2 -7q-1 -2 -2 -6q-2 -4 -2 -8q0 -3 1 -2q8 24 17 29q8 1 23 -7v-9q-9 3 -6 0t0 -2q-1 1 -2 1q-6 2 -10 1q-3 1 0 -1l18 -6v-18q-7 2 -10 4q-5 3 -13 1q-2 0 0 -2q4 -1 23 -8v-23q-6 2 -10 3q-4 2 -1 -2
				q-5 1 -12 1t-14 -2q-3 -1 1 -2q13 2 35 -3v-14q1 -5 1 -8q0 -8 -3 -17zM95 67q-2 10 -1 17q3 0 9 -3q3 0 3 2q0 3 -3 2q-5 2 -9 5v9h3h6t2 2q-1 1 -4 2q-4 1 -7 2v8q20 -3 24 -33q3 -14 -5 -16h-2q-8 0 -16 3z" />
		</svg>
    </div>
        <!--2.3之後加入-->
    </div>
    <div id="dropDIV" ondragover="dragoverHandler(event)" ondrop="dropHandler(event)">
        Drag and Drop 展示區 (接收任何SVG)
    </div>

    <script type="text/javascript">
		var first = document.getElementById("first");
		var second = document.getElementById("second");
		var third = document.getElementById("third");
		//console.log(typeof(first.getAttribute("d"))); //string
		var svg = d3.select("#rect")
					.append("svg")
					.attr("viewBox", "-10 0 273 256")
		var svg2 = d3.select("#rect2")
					.append("svg")
					.attr("viewBox", "-10 0 273 256")
		var svg3 = d3.select("#rect3")
					.append("svg")
					.attr("viewBox", "-10 0 273 256")

		arrangeCoordinate(first.getAttribute("d"),svg)
		arrangeCoordinate(second.getAttribute("d"),svg2)
		arrangeCoordinate(third.getAttribute("d"),svg3)
		function arrangeCoordinate(path,svg){
			var countM = 0; //unuseful
			var countQ = 0; //unuseful
			var countH = 0; //unuseful
			var countL = 0; //unuseful
			var countV = 0; //unuseful
			var countZ = 0; //unuseful
			var countSpace = 0;
			var singleStr = "";

			var allList = [];
			var countNum = 0;
			for (var i = 0; i < path.length; i++) {
				if(path[i] == "M"){
					countM++;
					allList.push(singleStr);
					singleStr = "";
					allList.push("M");
					//countNum++;
				}
				else if(path[i] == "q"){
					countQ++;
					allList.push(singleStr);
					singleStr = "";
					allList.push("q");
					countNum++;
				}
				else if(path[i] == "h"){
					countH++;
					allList.push(singleStr);
					singleStr = "";
					allList.push("h");
					countNum++;
				}
				else if(path[i] == "l"){
					countL++;
					allList.push(singleStr);
					singleStr = "";
					allList.push("l");
					//countNum++;
				}
				else if(path[i] == "t"){
					countV++;
					allList.push(singleStr);
					singleStr = "";
					allList.push("t");
					countNum++;
				}
				else if(path[i] == "v"){
					countV++;
					allList.push(singleStr);
					singleStr = "";
					allList.push("v");
					countNum++;
				}
				else if(path[i] == "z"){
					countZ++; //多少筆畫
					allList.push(singleStr);
					singleStr = "";
					allList.push("z");
					countNum++;
				}
				else if(path[i] == " "){
					countSpace++;
					allList.push(singleStr);
					singleStr = "";
				}
				else{
					singleStr += path[i];
				}
			}
			drawCircle(path,svg,countNum,allList)
		}
		
		function drawCircle(path,svg,countNum,allList){
			//console.log(countNum)
			var n = countNum + 2;
			var r = 128;
			var x = 128;
			var y = 128;
			//circleList.push([x,y])
			var oldx,oldy;
			var circleQstr = "";
			var circleList = [];
			var circleQList = [];
			var circleAllList = [];
			for (var i = 0; i <= n; i++) {
				//console.log(i)
				var radians = 2 * Math.PI / 360 *(360 / n) * i //角度轉弧度
				//console.log(Math.sin(radians) * r)
				//console.log(Math.cos(radians) * r)
				if (i == 0) {
					circleList.push([128,256])
					circleQList.push([128,256])
					oldx = 128;
					oldy = 256;
					circleAllList.push([128,256])
				}
				else if(i == 1 && allList[3] == "l"){
					circleList.push([1,1])
					circleQList.push([1,1])
					oldx = (Math.sin(radians) * r + x);
					oldy = (Math.cos(radians) * r + y);
					circleAllList.push([1,1])
				}
				else{
					var n1 = ((Math.sin(radians) * r + x) - oldx) / 2;
					var n2 = ((Math.cos(radians) * r + y) - oldy) / 2;
					var n3 = n1 * 2;
					var n4 = n2 * 2;
					oldx = (Math.sin(radians) * r + x);
					oldy = (Math.cos(radians) * r + y);

					circleList.push([Math.sin(radians) * r + x,Math.cos(radians) * r + y])
					circleQList.push([n1,n2,n3,n4])
					circleAllList.push([n1,n2,n3,n4])
				}

			}//L轉q
			
			for (var i = 0; i <= n; i++) {
				if(i == 0){
					circleQstr = "M" + circleQList[i][0] + " " + circleList[i][1];
				}
				else if(i == 1){
					circleQstr += " l" + circleQList[i][0] + " " + circleQList[i][1];
				}
				else{
					circleQstr += " q" + circleQList[i][0] + " " + circleQList[i][1] + " " + circleQList[i][2] + " " + circleQList[i][3];
				}
			}
			arrangeAllList(path,svg,allList,circleAllList,circleQstr,countNum)
		}
		//drawCircle()
		
		function arrangeAllList(path,svg,allList,circleAllList,circleQstr,countNum){
			allList.shift() //先移除第一個空元素
			//console.log(circleAllList)
			//console.log(allList)
			var countCAL = 0; //159?139
			var truePosX,truePosY;
			var showStr = "";
			for (var i = 0; i < allList.length; i++) {
				if(allList[i] == "M"){
					showStr += "M";
					if (i == 0) {
						showStr += circleAllList[countCAL][0] + " " + circleAllList[countCAL][1];
						truePosX = circleAllList[countCAL][0];
						truePosY = circleAllList[countCAL][1];
					}
					else{
						showStr += (truePosX+1) + " " + (truePosY+1);
							truePosX += circleAllList[countCAL][2];
							truePosY += circleAllList[countCAL][3];
						
					}
					countCAL++;
				}
				else if(allList[i] == "q"){
					showStr += "q";
					showStr += circleAllList[countCAL][0] + " " + circleAllList[countCAL][1] + " " + circleAllList[countCAL][2] + " " + circleAllList[countCAL][3];
					truePosX += circleAllList[countCAL][2];
					truePosY += circleAllList[countCAL][3];
					countCAL++;
				}
				else if(allList[i] == "h"){
					showStr += "h";
					showStr += "0";
				}
				else if(allList[i] == "l"){
					showStr += "l";
					showStr += circleAllList[countCAL][0] + " " + circleAllList[countCAL][1];
					countCAL++;
				}
				else if(allList[i] == "v"){
					showStr += "v";
					showStr += "0";
				}
				else if(allList[i] == "t"){
					showStr += "t";
					showStr += circleAllList[countCAL][2] + " " + circleAllList[countCAL][3];
					truePosX += circleAllList[countCAL][2];
					truePosY += circleAllList[countCAL][3];
					countCAL++;
				}
				else if(allList[i] == "z"){
					showStr += " ";
				}

			}
			for (var i = countCAL; i < countNum; i++) {
				showStr += "q";
				showStr += circleAllList[i][0] + " " + circleAllList[i][1] + " " + circleAllList[i][2] + " " + circleAllList[i][3];
				truePosX += circleAllList[i][2];
				truePosY += circleAllList[i][3];
				countCAL++;
			}
			drawAnimate(path,svg,showStr,circleQstr)
		}
		//arrangeAllList()

		function drawAnimate(path,svg,showStr,circleQstr,){
			svg.append("path")
			   .attr("fill","none")
			   .attr("stroke","black")
			   .attr("stroke-width",5)
		   	   .attr('d', showStr)
		   	   .transition()
		   	   .delay(4000)
		   	   .duration(3000)
		   	   .attr('d', path)
		   	svg.append("path")
			   .attr("fill","none")
			   .attr("stroke","blue")
			   .attr("stroke-width",3)
		   	   .attr('d', circleQstr)
		   	   .transition()
		   	   .delay(4000)
		   	   .duration(3000)
		   	   .attr('d', path)
	   	}
    </script>
    </script>
</body>
</html>
  
